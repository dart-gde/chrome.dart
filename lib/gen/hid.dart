/* This file has been generated from hid.idl - do not edit */

/**
 * Use the `chrome.hid` API to interact with connected HID devices. This API
 * provides access to HID operations from within the context of an app. Using
 * this API, apps can function as drivers for hardware devices.
 * 
 * Errors generated by this API are reported by setting [runtime.lastError] and
 * executing the function's regular callback. The callback's regular parameters
 * will be undefined in this case.
 */
library chrome.hid;

import '../src/common.dart';

/**
 * Accessor for the `chrome.hid` namespace.
 */
final ChromeHid hid = new ChromeHid._();

class ChromeHid extends ChromeApi {
  JsObject get _hid => chrome['hid'];

  Stream<HidDeviceInfo> get onDeviceAdded => _onDeviceAdded.stream;
  ChromeStreamController<HidDeviceInfo> _onDeviceAdded;

  Stream<int> get onDeviceRemoved => _onDeviceRemoved.stream;
  ChromeStreamController<int> _onDeviceRemoved;

  ChromeHid._() {
    var getApi = () => _hid;
    _onDeviceAdded = new ChromeStreamController<HidDeviceInfo>.oneArg(getApi, 'onDeviceAdded', _createHidDeviceInfo);
    _onDeviceRemoved = new ChromeStreamController<int>.oneArg(getApi, 'onDeviceRemoved', selfConverter);
  }

  bool get available => _hid != null;

  /**
   * Enumerate connected HID devices.
   * [options]: The properties to search for on target devices.
   */
  Future<List<HidDeviceInfo>> getDevices(HidGetDevicesOptions options) {
    if (_hid == null) _throwNotAvailable();

    var completer = new ChromeCompleter<List<HidDeviceInfo>>.oneArg((e) => listify(e, _createHidDeviceInfo));
    _hid.callMethod('getDevices', [jsify(options), completer.callback]);
    return completer.future;
  }

  /**
   * Open a connection to an HID device for communication.
   * [deviceId]: The [HidDeviceInfo.deviceId] of the device to open.
   */
  Future<HidConnectInfo> connect(int deviceId) {
    if (_hid == null) _throwNotAvailable();

    var completer = new ChromeCompleter<HidConnectInfo>.oneArg(_createHidConnectInfo);
    _hid.callMethod('connect', [deviceId, completer.callback]);
    return completer.future;
  }

  /**
   * Disconnect from a device. Invoking operations on a device after calling
   * this is safe but has no effect.
   * [connectionId]: The `connectionId` returned by [connect].
   */
  Future disconnect(int connectionId) {
    if (_hid == null) _throwNotAvailable();

    var completer = new ChromeCompleter.noArgs();
    _hid.callMethod('disconnect', [connectionId, completer.callback]);
    return completer.future;
  }

  /**
   * Receive the next input report from the device.
   * [connectionId]: The `connectionId` returned by [connect].
   * 
   * Returns:
   * [reportId] null
   * [data] null
   */
  Future<ReceiveResult> receive(int connectionId) {
    if (_hid == null) _throwNotAvailable();

    var completer = new ChromeCompleter<ReceiveResult>.twoArgs(ReceiveResult._create);
    _hid.callMethod('receive', [connectionId, completer.callback]);
    return completer.future;
  }

  /**
   * Send an output report to the device.
   * 
   * _Note:_ Do not include a report ID prefix in `data`. It will be added if
   * necessary.
   * [connectionId]: The `connectionId` returned by [connect].
   * [reportId]: The report ID to use, or `0` if none.
   * [data]: The report data.
   */
  Future send(int connectionId, int reportId, ArrayBuffer data) {
    if (_hid == null) _throwNotAvailable();

    var completer = new ChromeCompleter.noArgs();
    _hid.callMethod('send', [connectionId, reportId, jsify(data), completer.callback]);
    return completer.future;
  }

  /**
   * Request a feature report from the device.
   * [connectionId]: The `connectionId` returned by [connect].
   * [reportId]: The report ID, or `0` if none.
   * 
   * Returns:
   * 
   * [data]: The report data, including a report ID prefix if one is sent by the
   * device.
   */
  Future<ArrayBuffer> receiveFeatureReport(int connectionId, int reportId) {
    if (_hid == null) _throwNotAvailable();

    var completer = new ChromeCompleter<ArrayBuffer>.oneArg(_createArrayBuffer);
    _hid.callMethod('receiveFeatureReport', [connectionId, reportId, completer.callback]);
    return completer.future;
  }

  /**
   * Send a feature report to the device.
   * 
   * _Note:_ Do not include a report ID prefix in `data`. It will be added if
   * necessary.
   * [connectionId]: The `connectionId` returned by [connect].
   * [reportId]: The report ID to use, or `0` if none.
   * [data]: The report data.
   */
  Future sendFeatureReport(int connectionId, int reportId, ArrayBuffer data) {
    if (_hid == null) _throwNotAvailable();

    var completer = new ChromeCompleter.noArgs();
    _hid.callMethod('sendFeatureReport', [connectionId, reportId, jsify(data), completer.callback]);
    return completer.future;
  }

  void _throwNotAvailable() {
    throw new UnsupportedError("'chrome.hid' is not available");
  }
}

class HidCollectionInfo extends ChromeObject {
  HidCollectionInfo({int usagePage, int usage, List<int> reportIds}) {
    if (usagePage != null) this.usagePage = usagePage;
    if (usage != null) this.usage = usage;
    if (reportIds != null) this.reportIds = reportIds;
  }
  HidCollectionInfo.fromProxy(JsObject jsProxy): super.fromProxy(jsProxy);

  int get usagePage => jsProxy['usagePage'];
  set usagePage(int value) => jsProxy['usagePage'] = value;

  int get usage => jsProxy['usage'];
  set usage(int value) => jsProxy['usage'] = value;

  List<int> get reportIds => listify(jsProxy['reportIds']);
  set reportIds(List<int> value) => jsProxy['reportIds'] = jsify(value);
}

class HidDeviceInfo extends ChromeObject {
  HidDeviceInfo({int deviceId, int vendorId, int productId, List<HidCollectionInfo> collections, int maxInputReportSize, int maxOutputReportSize, int maxFeatureReportSize}) {
    if (deviceId != null) this.deviceId = deviceId;
    if (vendorId != null) this.vendorId = vendorId;
    if (productId != null) this.productId = productId;
    if (collections != null) this.collections = collections;
    if (maxInputReportSize != null) this.maxInputReportSize = maxInputReportSize;
    if (maxOutputReportSize != null) this.maxOutputReportSize = maxOutputReportSize;
    if (maxFeatureReportSize != null) this.maxFeatureReportSize = maxFeatureReportSize;
  }
  HidDeviceInfo.fromProxy(JsObject jsProxy): super.fromProxy(jsProxy);

  int get deviceId => jsProxy['deviceId'];
  set deviceId(int value) => jsProxy['deviceId'] = value;

  int get vendorId => jsProxy['vendorId'];
  set vendorId(int value) => jsProxy['vendorId'] = value;

  int get productId => jsProxy['productId'];
  set productId(int value) => jsProxy['productId'] = value;

  List<HidCollectionInfo> get collections => listify(jsProxy['collections'], _createHidCollectionInfo);
  set collections(List<HidCollectionInfo> value) => jsProxy['collections'] = jsify(value);

  int get maxInputReportSize => jsProxy['maxInputReportSize'];
  set maxInputReportSize(int value) => jsProxy['maxInputReportSize'] = value;

  int get maxOutputReportSize => jsProxy['maxOutputReportSize'];
  set maxOutputReportSize(int value) => jsProxy['maxOutputReportSize'] = value;

  int get maxFeatureReportSize => jsProxy['maxFeatureReportSize'];
  set maxFeatureReportSize(int value) => jsProxy['maxFeatureReportSize'] = value;
}

class HidConnectInfo extends ChromeObject {
  HidConnectInfo({int connectionId}) {
    if (connectionId != null) this.connectionId = connectionId;
  }
  HidConnectInfo.fromProxy(JsObject jsProxy): super.fromProxy(jsProxy);

  int get connectionId => jsProxy['connectionId'];
  set connectionId(int value) => jsProxy['connectionId'] = value;
}

class DeviceFilter extends ChromeObject {
  DeviceFilter({int vendorId, int productId, int usagePage, int usage}) {
    if (vendorId != null) this.vendorId = vendorId;
    if (productId != null) this.productId = productId;
    if (usagePage != null) this.usagePage = usagePage;
    if (usage != null) this.usage = usage;
  }
  DeviceFilter.fromProxy(JsObject jsProxy): super.fromProxy(jsProxy);

  int get vendorId => jsProxy['vendorId'];
  set vendorId(int value) => jsProxy['vendorId'] = value;

  int get productId => jsProxy['productId'];
  set productId(int value) => jsProxy['productId'] = value;

  int get usagePage => jsProxy['usagePage'];
  set usagePage(int value) => jsProxy['usagePage'] = value;

  int get usage => jsProxy['usage'];
  set usage(int value) => jsProxy['usage'] = value;
}

class HidGetDevicesOptions extends ChromeObject {
  HidGetDevicesOptions({int vendorId, int productId, List<DeviceFilter> filters}) {
    if (vendorId != null) this.vendorId = vendorId;
    if (productId != null) this.productId = productId;
    if (filters != null) this.filters = filters;
  }
  HidGetDevicesOptions.fromProxy(JsObject jsProxy): super.fromProxy(jsProxy);

  int get vendorId => jsProxy['vendorId'];
  set vendorId(int value) => jsProxy['vendorId'] = value;

  int get productId => jsProxy['productId'];
  set productId(int value) => jsProxy['productId'] = value;

  List<DeviceFilter> get filters => listify(jsProxy['filters'], _createDeviceFilter);
  set filters(List<DeviceFilter> value) => jsProxy['filters'] = jsify(value);
}

/**
 * The return type for [receive].
 */
class ReceiveResult {
  static ReceiveResult _create(reportId, data) {
    return new ReceiveResult._(reportId, _createArrayBuffer(data));
  }

  int reportId;
  ArrayBuffer data;

  ReceiveResult._(this.reportId, this.data);
}

HidDeviceInfo _createHidDeviceInfo(JsObject jsProxy) => jsProxy == null ? null : new HidDeviceInfo.fromProxy(jsProxy);
HidConnectInfo _createHidConnectInfo(JsObject jsProxy) => jsProxy == null ? null : new HidConnectInfo.fromProxy(jsProxy);
ArrayBuffer _createArrayBuffer(/*JsObject*/ jsProxy) => jsProxy == null ? null : new ArrayBuffer.fromProxy(jsProxy);
HidCollectionInfo _createHidCollectionInfo(JsObject jsProxy) => jsProxy == null ? null : new HidCollectionInfo.fromProxy(jsProxy);
DeviceFilter _createDeviceFilter(JsObject jsProxy) => jsProxy == null ? null : new DeviceFilter.fromProxy(jsProxy);
